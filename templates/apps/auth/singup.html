<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Form</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        html {
            height: 100%;
        }

        .form-container {
            min-height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
        }

        .toggle-button {
            transition: all 0.3s ease;
        }

        .toggle-button.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .form-field {
            transition: all 0.3s ease;
        }

        .form-field.hidden {
            display: none;
        }

        select, input {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .multiselect-option {
            padding: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .multiselect-option:hover {
            background-color: #f3f4f6;
        }

        .multiselect-option.selected {
            background-color: #dbeafe;
        }
    </style>
    <style>@view-transition {
        navigation: auto;
    }</style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>
<body>
<div class="form-container" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div style="background: white; border-radius: 1rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); padding: 2.5rem; width: 100%; max-width: 500px;">
        <h1 id="form-title"
            style="font-size: 2rem; font-weight: 700; text-align: center; margin-bottom: 2rem; color: #1f2937;">
            Registration Form</h1><!-- User Type Toggle -->
        <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
            <button id="client-toggle" class="toggle-button active"
                    style="flex: 1; padding: 0.875rem; border-radius: 0.5rem; font-weight: 600; border: 2px solid #667eea; background: #667eea; color: white; cursor: pointer;">
                <span id="client-label">Client</span></button>
            <button id="interpreter-toggle" class="toggle-button"
                    style="flex: 1; padding: 0.875rem; border-radius: 0.5rem; font-weight: 600; border: 2px solid #e5e7eb; background: white; color: #6b7280; cursor: pointer;">
                <span id="interpreter-label">Interpreter</span></button>
        </div>
        <form id="registration-form" , method="post" action="{% url 'interpreter_signup' %}"><!-- Common Fields -->
            {% csrf_token %}
            <div class="form-field" style="margin-bottom: 1.25rem;">
                <label for="first-name"
                       style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">First Name<span
                        style="color: #ef4444;">*</span>
                </label>
                <input type="text" name="first_name" id="first-name" required
                       style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
            </div>
            <div class="form-field" style="margin-bottom: 1.25rem;"><label for="last-name"
                                                                           style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Last
                Name <span style="color: #ef4444;">*</span></label> <input type="text" name="last_name" id="last-name"
                                                                           required
                                                                           style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
            </div>
            <div class="form-field" style="margin-bottom: 1.25rem;"><label for="phone"
                                                                           style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Phone
                <span style="color: #ef4444;">*</span></label> <input type="tel" name="phone" id="phone" required
                                                                      style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
            </div>
            <div class="form-field" style="margin-bottom: 1.25rem;"><label for="email"
                                                                           style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Email
                <span style="color: #ef4444;">*</span></label> <input type="email" name="email" id="email" required
                                                                      style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
            </div>
            <div class="form-field" style="margin-bottom: 1.25rem;"><label for="password"
                                                                           style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Password
                <span style="color: #ef4444;">*</span></label> <input type="password" name="password" id="password"
                                                                      required
                                                                      style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
            </div>
            <div class="form-field" style="margin-bottom: 1.25rem;"><label for="confirm-password"
                                                                           style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Confirm
                Password <span style="color: #ef4444;">*</span></label> <input type="password" name="confirm_password"
                                                                               id="confirm-password"
                                                                               required
                                                                               style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
            </div><!-- Interpreter-only Fields -->
            <div id="interpreter-fields" class="hidden">
                <div class="form-field" style="margin-bottom: 1.25rem;"><label for="gender"
                                                                               style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Gender
                    <span style="color: #ef4444;">*</span></label> <select name="gender" id="gender"
                                                                           style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem; background: white;">
                    <option value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
                </div>
                <div class="form-field" style="margin-bottom: 1.25rem;"><label for="city"
                                                                               style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">City
                    <span style="color: #ef4444;">*</span></label> <select name="city" id="city"
                                                                           style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem; background: white;">
                    {% for city in cities %}
                        <option value="{{ city.id }}">{{ city.name }}</option>
                    {% endfor %}


                </select>
                </div>
                <div class="form-field" style="margin-bottom: 1.25rem;"><label
                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Ready for Trips
                    <span style="color: #ef4444;">*</span></label>
                    <div class="checkbox-wrapper"><input type="checkbox" name="is_ready_for_trips" id="ready-trips"
                                                         style="width: 1.25rem; height: 1.25rem; cursor: pointer;">
                        <label for="ready-trips" style="cursor: pointer; color: #6b7280;">I am ready for business
                            trips</label>
                    </div>
                </div>
                <div class="form-field" style="margin-bottom: 1.25rem;"><label
                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Languages <span
                        style="color: #ef4444;">*</span></label>
                    <div id="languages-list" style="border: 2px solid #e5e7eb; border-radius: 0.5rem; padding: 0.5rem;">
                        <div class="multiselect-option" data-value="eng_ru"><input type="checkbox" name="language"
                                                                                   value="eng_ru"
                                                                                   style="width: 1.125rem; height: 1.125rem; cursor: pointer;">
                            <span>English - Russian</span>
                        </div>
                        <div class="multiselect-option" data-value="ru_uz"><input type="checkbox" name="language"
                                                                                  value="ru_uz"
                                                                                  style="width: 1.125rem; height: 1.125rem; cursor: pointer;">
                            <span>Russian - Uzbek</span>
                        </div>
                        <div class="multiselect-option" data-value="en_uz"><input type="checkbox" name="language"
                                                                                  value="en_uz"
                                                                                  style="width: 1.125rem; height: 1.125rem; cursor: pointer;">
                            <span>English - Uzbek</span>
                        </div>
                    </div>
                </div>
                <div class="form-field" style="margin-bottom: 1.25rem;"><label
                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151;">Translation
                    Type <span style="color: #ef4444;">*</span></label>
                    <div id="translation-type-list"
                         style="border: 2px solid #e5e7eb; border-radius: 0.5rem; padding: 0.5rem;">
                        <div class="multiselect-option" data-value="simultaneous"><input type="checkbox"
                                                                                         name="translation_type"
                                                                                         value="simultaneous"
                                                                                         style="width: 1.125rem; height: 1.125rem; cursor: pointer;">
                            <span>Simultaneous</span>
                        </div>
                        <div class="multiselect-option" data-value="consecutive"><input type="checkbox"
                                                                                        name="translation_type"
                                                                                        value="consecutive"
                                                                                        style="width: 1.125rem; height: 1.125rem; cursor: pointer;">
                            <span>Consecutive</span>
                        </div>
                        <div class="multiselect-option" data-value="written"><input type="checkbox"
                                                                                    name="translation_type"
                                                                                    value="written"
                                                                                    style="width: 1.125rem; height: 1.125rem; cursor: pointer;">
                            <span>Written</span>
                        </div>
                    </div>
                </div>
            </div>
            <button type="submit"
                    style="width: 100%; padding: 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 700; font-size: 1.125rem; border-radius: 0.5rem; border: none; cursor: pointer; margin-top: 1.5rem; transition: transform 0.2s ease, box-shadow 0.2s ease;">
                Register
            </button>
        </form><!-- Divider -->
        <div style="display: flex; align-items: center; margin: 1.5rem 0;">
            <div style="flex: 1; height: 1px; background: #e5e7eb;"></div>
            <span style="padding: 0 1rem; color: #6b7280; font-size: 0.875rem;">or</span>
            <div style="flex: 1; height: 1px; background: #e5e7eb;"></div>
        </div><!-- Google Registration Button -->
        <button id="google-register" type="button"
                style="width: 100%; padding: 1rem; background: white; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 0.75rem; color: #374151;">
            <svg width="20" height="20" viewbox="0 0 24 24">
                <path fill="#4285F4"
                      d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853"
                      d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05"
                      d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335"
                      d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span id="google-button-text">Continue with Google</span></button>
        <div id="success-message"
             style="display: none; margin-top: 1.5rem; padding: 1rem; background: #d1fae5; border: 2px solid #10b981; border-radius: 0.5rem; color: #065f46; text-align: center; font-weight: 600;">
            Registration successful!
        </div>
    </div>
</div>
<script>
    const defaultConfig = {
        form_title: "Registration Form",
        client_label: "Client",
        interpreter_label: "Interpreter",
        google_button_text: "Continue with Google",
        background_color: "#667eea",
        surface_color: "#ffffff",
        text_color: "#1f2937",
        primary_action_color: "#667eea",
        secondary_action_color: "#e5e7eb",
        font_family: "Inter",
        font_size: 16
    };

    let config = {...defaultConfig};
    let currentUserType = 'client';

    const clientToggle = document.getElementById('client-toggle');
    const interpreterToggle = document.getElementById('interpreter-toggle');
    const interpreterFields = document.getElementById('interpreter-fields');
    const form = document.getElementById('registration-form');
    const successMessage = document.getElementById('success-message');
    const googleRegisterBtn = document.getElementById('google-register');

    function switchUserType(type) {
        currentUserType = type;

        if (type === 'client') {
            clientToggle.classList.add('active');
            interpreterToggle.classList.remove('active');
            interpreterFields.classList.add('hidden');

            clientToggle.style.background = config.primary_action_color || defaultConfig.primary_action_color;
            clientToggle.style.borderColor = config.primary_action_color || defaultConfig.primary_action_color;
            clientToggle.style.color = 'white';

            interpreterToggle.style.background = 'white';
            interpreterToggle.style.borderColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            interpreterToggle.style.color = '#6b7280';

            const interpreterInputs = interpreterFields.querySelectorAll('input, select');
            interpreterInputs.forEach(input => {
                input.removeAttribute('required');
            });
        } else {
            interpreterToggle.classList.add('active');
            clientToggle.classList.remove('active');
            interpreterFields.classList.remove('hidden');

            interpreterToggle.style.background = config.primary_action_color || defaultConfig.primary_action_color;
            interpreterToggle.style.borderColor = config.primary_action_color || defaultConfig.primary_action_color;
            interpreterToggle.style.color = 'white';

            clientToggle.style.background = 'white';
            clientToggle.style.borderColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            clientToggle.style.color = '#6b7280';

            document.getElementById('gender').setAttribute('required', 'required');
            document.getElementById('city').setAttribute('required', 'required');
        }
    }

    clientToggle.addEventListener('click', () => switchUserType('client'));
    interpreterToggle.addEventListener('click', () => switchUserType('interpreter'));

    const multiselectOptions = document.querySelectorAll('.multiselect-option');
    multiselectOptions.forEach(option => {
        option.addEventListener('click', (e) => {
            if (e.target.tagName !== 'INPUT') {
                const checkbox = option.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;
            }
            option.classList.toggle('selected', option.querySelector('input[type="checkbox"]').checked);
        });
    });

    form.addEventListener('submit', (e) => {


        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (password !== confirmPassword) {
            e.preventDefault();
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'margin-top: 1rem; padding: 1rem; background: #fee2e2; border: 2px solid #ef4444; border-radius: 0.5rem; color: #991b1b; text-align: center; font-weight: 600;';
            errorDiv.textContent = 'Passwords do not match!';

            const existingError = form.querySelector('[style*="fee2e2"]');
            if (existingError) existingError.remove();

            form.appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
            return;
        }

        if (currentUserType === 'interpreter') {
            const languages = Array.from(document.querySelectorAll('#languages-list input:checked')).map(cb => cb.value);
            const translationTypes = Array.from(document.querySelectorAll('#translation-type-list input:checked')).map(cb => cb.value);

            if (languages.length === 0 || translationTypes.length === 0) {
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'margin-top: 1rem; padding: 1rem; background: #fee2e2; border: 2px solid #ef4444; border-radius: 0.5rem; color: #991b1b; text-align: center; font-weight: 600;';
                errorDiv.textContent = 'Please select at least one language and translation type!';

                const existingError = form.querySelector('[style*="fee2e2"]');
                if (existingError) existingError.remove();

                form.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 3000);
                return;
            }
        }

        successMessage.style.display = 'block';
        form.reset();
        switchUserType('client');

        setTimeout(() => {
            successMessage.style.display = 'none';
        }, 3000);
    });

    // Google Registration Handler
    googleRegisterBtn.addEventListener('click', () => {
        // Show loading state
        const originalText = googleRegisterBtn.querySelector('span').textContent;
        googleRegisterBtn.querySelector('span').textContent = 'Connecting...';
        googleRegisterBtn.style.opacity = '0.7';
        googleRegisterBtn.disabled = true;

        // Simulate Google OAuth flow
        setTimeout(() => {
            // Show user type selection modal for Google users
            showGoogleUserTypeModal();

            // Reset button
            googleRegisterBtn.querySelector('span').textContent = originalText;
            googleRegisterBtn.style.opacity = '1';
            googleRegisterBtn.disabled = false;
        }, 1500);
    });

    function showGoogleUserTypeModal() {
        // Create modal overlay
        const modalOverlay = document.createElement('div');
        modalOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      `;

        // Create modal content
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      `;

        modalContent.innerHTML = `
        <div style="margin-bottom: 1.5rem;">
          <div style="width: 60px; height: 60px; background: #4285F4; border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;">
            <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
          </div>
          <h3 style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: 700; color: #1f2937;">Google Account Connected</h3>
          <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">john.doe@gmail.com</p>
        </div>

        <p style="margin-bottom: 1.5rem; color: #374151; font-weight: 600;">Select your account type:</p>

        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
          <button id="modal-client-btn" style="flex: 1; padding: 1rem; border: 2px solid #667eea; background: #667eea; color: white; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
            Client
          </button>
          <button id="modal-interpreter-btn" style="flex: 1; padding: 1rem; border: 2px solid #e5e7eb; background: white; color: #6b7280; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
            Interpreter
          </button>
        </div>

        <button id="complete-google-registration" style="width: 100%; padding: 0.875rem; background: #10b981; color: white; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; margin-bottom: 1rem;">
          Complete Registration
        </button>

        <button id="cancel-google-registration" style="width: 100%; padding: 0.875rem; background: transparent; color: #6b7280; border: none; cursor: pointer; font-weight: 500;">
          Cancel
        </button>
      `;

        modalOverlay.appendChild(modalContent);
        document.body.appendChild(modalOverlay);

        let selectedType = 'client';

        // Modal button handlers
        const modalClientBtn = modalContent.querySelector('#modal-client-btn');
        const modalInterpreterBtn = modalContent.querySelector('#modal-interpreter-btn');
        const completeBtn = modalContent.querySelector('#complete-google-registration');
        const cancelBtn = modalContent.querySelector('#cancel-google-registration');

        function selectModalType(type) {
            selectedType = type;
            if (type === 'client') {
                modalClientBtn.style.background = '#667eea';
                modalClientBtn.style.borderColor = '#667eea';
                modalClientBtn.style.color = 'white';
                modalInterpreterBtn.style.background = 'white';
                modalInterpreterBtn.style.borderColor = '#e5e7eb';
                modalInterpreterBtn.style.color = '#6b7280';
            } else {
                modalInterpreterBtn.style.background = '#667eea';
                modalInterpreterBtn.style.borderColor = '#667eea';
                modalInterpreterBtn.style.color = 'white';
                modalClientBtn.style.background = 'white';
                modalClientBtn.style.borderColor = '#e5e7eb';
                modalClientBtn.style.color = '#6b7280';
            }
        }

        modalClientBtn.addEventListener('click', () => selectModalType('client'));
        modalInterpreterBtn.addEventListener('click', () => selectModalType('interpreter'));

        completeBtn.addEventListener('click', () => {
            // Show success message
            successMessage.style.display = 'block';
            successMessage.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#10b981">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span>Google registration successful as ${selectedType}!</span>
          </div>
        `;

            // Close modal
            document.body.removeChild(modalOverlay);

            // Hide success message after 3 seconds
            setTimeout(() => {
                successMessage.style.display = 'none';
                successMessage.innerHTML = 'Registration successful!';
            }, 3000);
        });

        cancelBtn.addEventListener('click', () => {
            document.body.removeChild(modalOverlay);
        });

        // Close modal on overlay click
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                document.body.removeChild(modalOverlay);
            }
        });
    }

    async function onConfigChange(newConfig) {
        const formTitle = document.getElementById('form-title');
        const clientLabel = document.getElementById('client-label');
        const interpreterLabel = document.getElementById('interpreter-label');
        const container = document.querySelector('.form-container');
        const formBox = container.querySelector('div');
        const submitButton = form.querySelector('button[type="submit"]');
        const labels = document.querySelectorAll('label');

        const customFont = newConfig.font_family || defaultConfig.font_family;
        const baseFontStack = '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
        const baseSize = newConfig.font_size || defaultConfig.font_size;

        formTitle.textContent = newConfig.form_title || defaultConfig.form_title;
        clientLabel.textContent = newConfig.client_label || defaultConfig.client_label;
        interpreterLabel.textContent = newConfig.interpreter_label || defaultConfig.interpreter_label;

        container.style.background = `linear-gradient(135deg, ${newConfig.background_color || defaultConfig.background_color} 0%, ${newConfig.primary_action_color || defaultConfig.primary_action_color} 100%)`;
        formBox.style.background = newConfig.surface_color || defaultConfig.surface_color;
        formTitle.style.color = newConfig.text_color || defaultConfig.text_color;

        labels.forEach(label => {
            label.style.color = newConfig.text_color || defaultConfig.text_color;
        });

        submitButton.style.background = `linear-gradient(135deg, ${newConfig.primary_action_color || defaultConfig.primary_action_color} 0%, ${newConfig.background_color || defaultConfig.background_color} 100%)`;

        googleRegisterBtn.style.borderColor = newConfig.secondary_action_color || defaultConfig.secondary_action_color;
        googleRegisterBtn.style.color = newConfig.text_color || defaultConfig.text_color;

        if (currentUserType === 'client') {
            clientToggle.style.background = newConfig.primary_action_color || defaultConfig.primary_action_color;
            clientToggle.style.borderColor = newConfig.primary_action_color || defaultConfig.primary_action_color;
            interpreterToggle.style.borderColor = newConfig.secondary_action_color || defaultConfig.secondary_action_color;
        } else {
            interpreterToggle.style.background = newConfig.primary_action_color || defaultConfig.primary_action_color;
            interpreterToggle.style.borderColor = newConfig.primary_action_color || defaultConfig.primary_action_color;
            clientToggle.style.borderColor = newConfig.secondary_action_color || defaultConfig.secondary_action_color;
        }

        formTitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
        formTitle.style.fontSize = `${baseSize * 2}px`;

        clientLabel.style.fontFamily = `${customFont}, ${baseFontStack}`;
        interpreterLabel.style.fontFamily = `${customFont}, ${baseFontStack}`;

        labels.forEach(label => {
            label.style.fontFamily = `${customFont}, ${baseFontStack}`;
            label.style.fontSize = `${baseSize}px`;
        });

        submitButton.style.fontFamily = `${customFont}, ${baseFontStack}`;
        submitButton.style.fontSize = `${baseSize * 1.125}px`;

        googleRegisterBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
        googleRegisterBtn.style.fontSize = `${baseSize}px`;

        const googleButtonText = document.getElementById('google-button-text');
        googleButtonText.textContent = newConfig.google_button_text || defaultConfig.google_button_text;
    }

    if (window.elementSdk) {
        window.elementSdk.init({
            defaultConfig,
            onConfigChange: async (newConfig) => {
                config = {...config, ...newConfig};
                await onConfigChange(config);
            },
            mapToCapabilities: (cfg) => ({
                recolorables: [
                    {
                        get: () => cfg.background_color || defaultConfig.background_color,
                        set: (value) => {
                            cfg.background_color = value;
                            window.elementSdk.setConfig({background_color: value});
                        }
                    },
                    {
                        get: () => cfg.surface_color || defaultConfig.surface_color,
                        set: (value) => {
                            cfg.surface_color = value;
                            window.elementSdk.setConfig({surface_color: value});
                        }
                    },
                    {
                        get: () => cfg.text_color || defaultConfig.text_color,
                        set: (value) => {
                            cfg.text_color = value;
                            window.elementSdk.setConfig({text_color: value});
                        }
                    },
                    {
                        get: () => cfg.primary_action_color || defaultConfig.primary_action_color,
                        set: (value) => {
                            cfg.primary_action_color = value;
                            window.elementSdk.setConfig({primary_action_color: value});
                        }
                    },
                    {
                        get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color,
                        set: (value) => {
                            cfg.secondary_action_color = value;
                            window.elementSdk.setConfig({secondary_action_color: value});
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => cfg.font_family || defaultConfig.font_family,
                    set: (value) => {
                        cfg.font_family = value;
                        window.elementSdk.setConfig({font_family: value});
                    }
                },
                fontSizeable: {
                    get: () => cfg.font_size || defaultConfig.font_size,
                    set: (value) => {
                        cfg.font_size = value;
                        window.elementSdk.setConfig({font_size: value});
                    }
                }
            }),
            mapToEditPanelValues: (cfg) => new Map([
                ["form_title", cfg.form_title || defaultConfig.form_title],
                ["client_label", cfg.client_label || defaultConfig.client_label],
                ["interpreter_label", cfg.interpreter_label || defaultConfig.interpreter_label],
                ["google_button_text", cfg.google_button_text || defaultConfig.google_button_text]
            ])
        });
    }
</script>
<script>(function () {
    function c() {
        var b = a.contentDocument || a.contentWindow.document;
        if (b) {
            var d = b.createElement('script');
            d.innerHTML = "window.__CF$cv$params={r:'999ce17b8519dcac',t:'MTc2MjM1MTI2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName('head')[0].appendChild(d)
        }
    }

    if (document.body) {
        var a = document.createElement('iframe');
        a.height = 1;
        a.width = 1;
        a.style.position = 'absolute';
        a.style.top = 0;
        a.style.left = 0;
        a.style.border = 'none';
        a.style.visibility = 'hidden';
        document.body.appendChild(a);
        if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else {
            var e = document.onreadystatechange || function () {
            };
            document.onreadystatechange = function (b) {
                e(b);
                'loading' !== document.readyState && (document.onreadystatechange = e, c())
            }
        }
    }
})();</script>
</body>
</html>