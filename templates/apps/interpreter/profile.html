{% extends 'apps/interpreter/base.html' %}
{% block title %}Interpreter Profile{% endblock %}

{% block content %}
<!-- Profile Section -->
<div id="profile-section" class="section">
    <div class="glass-card rounded-2xl p-8">
        <h3 class="text-2xl font-semibold section-title mb-8" id="profile-section-title">Profile Management</h3>
        <form id="profile-form">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><!-- Profile Photo -->
                <div class="lg:col-span-1">
                    <div class="text-center">
                        <div class="w-32 h-32 bg-gradient-to-r from-blue-400 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <span class="text-white text-4xl">üë®‚Äçüíº</span>
                        </div>
                        <button type="button" class="secondary-btn px-4 py-2 rounded-lg text-sm"> Change Photo
                        </button>
                    </div>
                </div><!-- Profile Information -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="profile-first-name" class="block text-sm font-medium mb-2">First
                            Name</label> <input type="text" id="profile-first-name" name="first_name"
                                                class="input-field w-full px-4 py-3 rounded-xl"
                                                placeholder="Enter first name">
                        </div>
                        <div><label for="profile-last-name" class="block text-sm font-medium mb-2">Last
                            Name</label> <input type="text" id="profile-last-name" name="last_name"
                                                class="input-field w-full px-4 py-3 rounded-xl"
                                                placeholder="Enter last name">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="profile-email" class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" id="profile-email" name="email"
                                   class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter email">
                        </div>
                        <div><label for="profile-phone" class="block text-sm font-medium mb-2">Phone</label>
                            <input type="tel" id="profile-phone" name="phone"
                                   class="input-field w-full px-4 py-3 rounded-xl" placeholder="Enter phone">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="profile-city" class="block text-sm font-medium mb-2">City</label>
                            <select id="profile-city" name="city"
                                    class="input-field w-full px-4 py-3 rounded-xl">
                                <option value="">Select city</option>
                                <option value="tashkent">Tashkent</option>
                                <option value="samarkand">Samarkand</option>
                                <option value="bukhara">Bukhara</option>
                            </select>
                        </div>
                        <div><label for="profile-rate" class="block text-sm font-medium mb-2">Hourly Rate
                            ($)</label> <input type="number" id="profile-rate" name="hourly_rate"
                                               class="input-field w-full px-4 py-3 rounded-xl"
                                               placeholder="Enter hourly rate">
                        </div>
                    </div>
                    <div><label for="profile-bio" class="block text-sm font-medium mb-2">Professional
                        Bio</label> <textarea id="profile-bio" name="bio" rows="4"
                                              class="input-field w-full px-4 py-3 rounded-xl"
                                              placeholder="Tell clients about your experience and expertise..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-4">
                        <button type="button" class="secondary-btn px-6 py-3 rounded-xl">Cancel</button>
                        <button type="submit" class="primary-btn px-6 py-3 rounded-xl">Save Changes</button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Google Calendar Integration UI -->
        <div class="mt-8 pt-8 border-t border-gray-700">
            <h3 class="text-2xl font-semibold section-title mb-4">Google Calendar Integration</h3>
            {% if request.user.is_authenticated and request.user.is_interpreter %}
                {% if not request.user.google_calendar_connected %}
                    <a href="{% url 'google_calendar_authorize' %}" class="primary-btn px-6 py-3 rounded-xl">
                        Connect Google Calendar
                    </a>
                {% else %}
                    <p class="text-green-500 mb-4">Google Calendar is connected.</p>
                    <div class="flex space-x-4">
                        <form action="{% url 'google_calendar_disconnect' %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="secondary-btn px-6 py-3 rounded-xl bg-red-600 hover:bg-red-700 text-white">Disconnect Calendar</button>
                        </form>
                        <button type="button" class="primary-btn px-6 py-3 rounded-xl" onclick="syncCalendar()">Sync Now</button>
                    </div>
                {% endif %}
            {% else %}
                <p class="text-red-500">You must be an authenticated interpreter to connect Google Calendar.</p>
            {% endif %}
        </div>

        <script>
            function syncCalendar() {
                // You might want to add a loading spinner or confirmation here
                fetch("{% url 'google_calendar_status' %}", { method: 'GET' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.connected) {
                            alert('Calendar sync initiated. Please refresh the page in a moment.');
                            window.location.reload(); // Simple reload for demonstration
                        } else {
                            alert('Google Calendar is not connected.');
                        }
                    })
                    .catch(error => console.error('Error checking calendar status:', error));
            }
        </script>
    </div>
</div>
{% endblock %}
